# Test Data Creation Guide for Hoop Theory Booking System

This guide explains the data structures and logic of the Hoop Theory booking system to help you create test data that properly matches the application's requirements.

---

## System Architecture Overview

The booking system has these core components:

1. **Available Slots** (`availableSlots.json`) - Sessions offered by Hoop Theory
2. **Bookings** (`bookings.json`) - Player bookings for sessions
3. **Booking Mappings** (`bookingMappings.json`) - Metadata linking bookings to booking IDs
4. **Players** (`players.json`) - Registered player information
5. **Player Profiles** (`playerProfiles.json`) - Extended player profile data
6. **Waitlist** (`waitlist.json`) - Players waiting for fully-booked sessions
7. **Offers** (`offers.json`) - Reserved spots for waitlisted players

---

## Key Data Structures

### 1. Available Slots (`availableSlots.json`)

Slots are organized by **date** as keys, containing an array of session objects.

```json
{
  "2026-02-20": [
    {
      "time": "04:07",
      "title": "werhtjyum",
      "sessionType": "group",
      "location": "Court A",
      "price": 15,
      "capacity": 20,
      "bookedUsers": [
        {
          "name": "Aghac Curtis",
          "email": "aghacurtis@gmail.com"
        }
      ],
      "blockId": null
    }
  ],
  "2026-02-21": [
    {
      "time": "10:00",
      "title": "Advanced Session",
      "sessionType": "1v1",
      "location": "Court B",
      "price": 25,
      "capacity": 1,
      "bookedUsers": [],
      "blockId": null
    }
  ]
}
```

**Important Fields:**
- `time`: HH:MM format (24-hour)
- `title`: Session name
- `sessionType`: "group" or "1v1"
- `location`: Where the session takes place
- `price`: Cost in pounds
- `capacity`: Max players allowed
- `bookedUsers`: Array of booked player objects (name, email)
- `blockId`: ID if this is part of a 4-week block series

**Block Sessions:**
Block sessions are linked across multiple dates using the same `blockId`. All dates in a block should have the same time and title:

```json
{
  "2026-02-20": [
    {
      "time": "14:00",
      "title": "4-Week Block",
      "blockId": "block-001",
      "capacity": 10,
      "bookedUsers": [],
      ...
    }
  ],
  "2026-02-27": [
    {
      "time": "14:00",
      "title": "4-Week Block",
      "blockId": "block-001",
      "capacity": 10,
      "bookedUsers": [],
      ...
    }
  ]
}
```

---

### 2. Bookings (`bookings.json`)

Bookings are organized by **date**, containing an array of booking strings.

```json
{
  "2026-02-20": [
    "04:07 - werhtjyum (Aghac Curtis) (aghacurtis@gmail.com)",
    "10:00 - Advanced Session (John Doe) (john@example.com)"
  ],
  "2026-02-21": [
    "14:00 - Group Training (Jane Smith) (jane@example.com)"
  ]
}
```

**Booking String Format:**
```
TIME - TITLE (NAME) (EMAIL)
```

**Critical Rules:**
1. Each booking must match a slot in `availableSlots.json` by date, time, and title
2. A player can only be booked once per session
3. Do NOT exceed the slot's capacity
4. Email must be a valid email address
5. Name must match or be related to the player's registered name

**Block Booking Example:**
When a player books a 4-week block, create entries for all dates:

```json
{
  "2026-02-20": ["14:00 - 4-Week Block (Player Name) (email@example.com)"],
  "2026-02-27": ["14:00 - 4-Week Block (Player Name) (email@example.com)"],
  "2026-03-06": ["14:00 - 4-Week Block (Player Name) (email@example.com)"],
  "2026-03-13": ["14:00 - 4-Week Block (Player Name) (email@example.com)"]
}
```

---

### 3. Booking Mappings (`bookingMappings.json`)

This file stores metadata for each booking to support confirmation emails and cancellations.

```json
{
  "admin-1706865240123-a1b2c3d4e": {
    "name": "Aghac Curtis",
    "email": "aghacurtis@gmail.com",
    "date": "2026-02-20",
    "slot": "04:07",
    "title": "werhtjyum",
    "isBlock": false,
    "blockDates": [],
    "price": 15,
    "location": "Court A",
    "createdAt": "2026-02-02T10:30:00Z",
    "timestamp": 1706865240
  },
  "admin-1706865400000-x9y8z7w6v": {
    "name": "John Doe",
    "email": "john@example.com",
    "date": "2026-02-20",
    "slot": "10:00",
    "title": "Advanced Session",
    "isBlock": false,
    "blockDates": [],
    "price": 25,
    "location": "Court B",
    "createdAt": "2026-02-02T10:32:00Z",
    "timestamp": 1706865400
  }
}
```

**Booking ID Format:**
- Admin-confirmed bookings: `admin-TIMESTAMP-RANDOMSTRING`
- Player bookings: Generated by system

**Important:** Every booking in `bookings.json` should have a corresponding entry in `bookingMappings.json` with the same email, slot, and title.

---

### 4. Players (`players.json`)

Simple registry of player names and emails.

```json
{
  "aghacurtis@gmail.com": "Aghac Curtis",
  "john@example.com": "John Doe",
  "jane@example.com": "Jane Smith"
}
```

**Requirements:**
- Email must be a valid email format
- Name should match what's used in bookings

---

### 5. Player Profiles (`playerProfiles.json`)

Extended profile information for players.

```json
{
  "aghacurtis@gmail.com": {
    "name": "Aghac Curtis",
    "email": "aghacurtis@gmail.com",
    "phone": "07123456789",
    "emergencyContact": "Jane Curtis",
    "emergencyPhone": "07987654321",
    "experience": "intermediate",
    "goals": "Improve shooting accuracy",
    "joinDate": "2026-01-15",
    "notes": "Interested in 1v1 coaching"
  }
}
```

**Optional Fields:** Can be empty or omitted
- `phone`
- `emergencyContact`
- `emergencyPhone`
- `experience`
- `goals`
- `notes`

---

### 6. Waitlist (`waitlist.json`)

Players waiting for spots in fully-booked sessions.

```json
{
  "2026-02-20|04:07|werhtjyum": [
    {
      "name": "Sarah Johnson",
      "email": "sarah@example.com",
      "position": 1,
      "addedAt": "2026-02-01T14:30:00Z"
    },
    {
      "name": "Mike Wilson",
      "email": "mike@example.com",
      "position": 2,
      "addedAt": "2026-02-01T15:45:00Z"
    }
  ]
}
```

**Waitlist Key Format:**
```
DATE|TIME|TITLE
```

**Requirements:**
- Position numbers must be sequential (1, 2, 3...)
- Email must match a player in `players.json`
- This is only used for sessions that are at capacity

---

### 7. Offers (`offers.json`)

Reserved spots sent to waitlisted players.

```json
{
  "offer-token-abc123xyz": {
    "email": "sarah@example.com",
    "date": "2026-02-20",
    "time": "04:07",
    "title": "werhtjyum",
    "status": "pending",
    "expiresAt": "2026-02-03T14:30:00Z",
    "createdAt": "2026-02-01T14:30:00Z"
  }
}
```

**Status Values:**
- `pending`: Waiting for player response
- `accepted`: Player accepted the offer
- `declined`: Player declined
- `expired`: Offer time window passed

---

## Data Consistency Rules

### Rule 1: Slot-Booking Consistency
Every booking in `bookings.json` must have a matching slot in `availableSlots.json`:

✅ **CORRECT:**
```json
// availableSlots.json
{
  "2026-02-20": [{"time": "04:07", "title": "werhtjyum", ...}]
}

// bookings.json
{
  "2026-02-20": ["04:07 - werhtjyum (Name) (email)"]
}
```

❌ **WRONG:**
```json
// availableSlots.json has no entry for this date
// bookings.json
{
  "2026-02-20": ["04:07 - werhtjyum (Name) (email)"]
}
```

### Rule 2: Capacity Constraint
`bookedUsers` count in a slot must not exceed capacity:

✅ **CORRECT:**
```json
{
  "capacity": 2,
  "bookedUsers": [
    {"name": "Player 1", "email": "p1@example.com"},
    {"name": "Player 2", "email": "p2@example.com"}
  ]
}
```

❌ **WRONG:**
```json
{
  "capacity": 2,
  "bookedUsers": [
    {"name": "Player 1", "email": "p1@example.com"},
    {"name": "Player 2", "email": "p2@example.com"},
    {"name": "Player 3", "email": "p3@example.com"}  // Exceeds capacity
  ]
}
```

### Rule 3: Player Registry
Every player in a booking must be registered in `players.json`:

✅ **CORRECT:**
```json
// players.json
{"aghacurtis@gmail.com": "Aghac Curtis"}

// bookings.json
{"2026-02-20": ["04:07 - werhtjyum (Aghac Curtis) (aghacurtis@gmail.com)"]}
```

❌ **WRONG:**
```json
// players.json is empty

// bookings.json tries to book unregistered player
{"2026-02-20": ["04:07 - werhtjyum (Unknown Player) (unknown@example.com)"]}
```

### Rule 4: Booking Mapping Completeness
Every booking should have a mapping entry with matching email, slot, and title:

✅ **CORRECT:**
```json
// bookingMappings.json
{
  "admin-1706865240123-a1b2c3d4e": {
    "email": "aghacurtis@gmail.com",
    "slot": "04:07",
    "title": "werhtjyum",
    "date": "2026-02-20"
  }
}

// bookings.json
{"2026-02-20": ["04:07 - werhtjyum (Aghac Curtis) (aghacurtis@gmail.com)"]}
```

### Rule 5: Block Session Consistency
For block sessions, all dates must have the same time, title, and blockId:

✅ **CORRECT:**
```json
{
  "2026-02-20": [{"time": "14:00", "title": "4-Week Block", "blockId": "block-001"}],
  "2026-02-27": [{"time": "14:00", "title": "4-Week Block", "blockId": "block-001"}],
  "2026-03-06": [{"time": "14:00", "title": "4-Week Block", "blockId": "block-001"}],
  "2026-03-13": [{"time": "14:00", "title": "4-Week Block", "blockId": "block-001"}]
}
```

❌ **WRONG:**
```json
{
  "2026-02-20": [{"time": "14:00", "title": "4-Week Block", "blockId": "block-001"}],
  "2026-02-27": [{"time": "15:00", "title": "4-Week Block", "blockId": "block-001"}]  // Different time!
}
```

---

## Test Data Creation Checklist

Before creating test data, ensure:

- [ ] All dates in `availableSlots.json` are in `YYYY-MM-DD` format
- [ ] All times are in `HH:MM` (24-hour) format
- [ ] Prices are numbers (e.g., `15` not `"15"`)
- [ ] Capacity is a number and `bookedUsers` count doesn't exceed it
- [ ] Every player in bookings is in `players.json`
- [ ] Booking strings follow the format: `TIME - TITLE (NAME) (EMAIL)`
- [ ] Block sessions have matching times/titles across all 4 dates with same `blockId`
- [ ] All emails are valid format
- [ ] Waitlist keys match the format `DATE|TIME|TITLE`
- [ ] Offer statuses are one of: pending, accepted, declined, expired
- [ ] Player profiles have email matching `players.json`
- [ ] `bookingMappings.json` has entries for key bookings (at minimum admin-confirmed ones)

---

## Example: Complete Test Dataset

Here's a minimal working test dataset:

```json
// availableSlots.json
{
  "2026-02-20": [
    {
      "time": "04:07",
      "title": "werhtjyum",
      "sessionType": "group",
      "location": "Court A",
      "price": 15,
      "capacity": 3,
      "bookedUsers": [
        {"name": "Aghac Curtis", "email": "aghacurtis@gmail.com"},
        {"name": "John Doe", "email": "john@example.com"}
      ],
      "blockId": null
    }
  ]
}

// bookings.json
{
  "2026-02-20": [
    "04:07 - werhtjyum (Aghac Curtis) (aghacurtis@gmail.com)",
    "04:07 - werhtjyum (John Doe) (john@example.com)"
  ]
}

// players.json
{
  "aghacurtis@gmail.com": "Aghac Curtis",
  "john@example.com": "John Doe"
}

// playerProfiles.json
{
  "aghacurtis@gmail.com": {
    "name": "Aghac Curtis",
    "email": "aghacurtis@gmail.com",
    "phone": "07123456789",
    "experience": "intermediate"
  },
  "john@example.com": {
    "name": "John Doe",
    "email": "john@example.com",
    "phone": "07987654321",
    "experience": "beginner"
  }
}

// bookingMappings.json
{
  "admin-1706865240123-a1b2c3d4e": {
    "name": "Aghac Curtis",
    "email": "aghacurtis@gmail.com",
    "date": "2026-02-20",
    "slot": "04:07",
    "title": "werhtjyum",
    "isBlock": false,
    "blockDates": [],
    "price": 15,
    "location": "Court A",
    "createdAt": "2026-02-02T10:30:00Z"
  }
}

// waitlist.json
{
  "2026-02-20|04:07|werhtjyum": [
    {
      "name": "Sarah Johnson",
      "email": "sarah@example.com",
      "position": 1,
      "addedAt": "2026-02-01T14:30:00Z"
    }
  ]
}

// offers.json
{
  "offer-abc123xyz": {
    "email": "sarah@example.com",
    "date": "2026-02-20",
    "time": "04:07",
    "title": "werhtjyum",
    "status": "pending",
    "expiresAt": "2026-02-05T14:30:00Z",
    "createdAt": "2026-02-01T14:30:00Z"
  }
}
```

---

## Testing Workflows

### Workflow 1: Test Admin Confirm Booking
1. Create a booking in `bookings.json` and `availableSlots.json`
2. Add player to `players.json`
3. In admin panel, click Confirm button
4. Verify email is sent (check logs)
5. Verify `bookingMappings.json` has new entry with bookingId
6. Verify status shows "Confirmed" in admin view

### Workflow 2: Test Waitlist → Offer → Accept
1. Create a full session (capacity = 2, bookedUsers = 2)
2. Add a waitlisted player to `waitlist.json`
3. Manually create an offer in `offers.json` with status "pending"
4. Verify waitlist display in admin view
5. Manually change offer status to "accepted"
6. Verify booking is created and offer is marked accepted

### Workflow 3: Test Block Bookings
1. Create a 4-week block session in `availableSlots.json` across 4 dates
2. All dates must have same time, title, and blockId
3. Book the block in `bookings.json` on all 4 dates
4. Create mapping for block (include blockDates array)
5. Confirm the booking
6. Verify email shows all 4 dates
7. Verify cancel link works with proper bookingId

---

## Troubleshooting

**"Booking not found" error when confirming:**
- Check booking string exactly matches a slot (time, title)
- Verify the date exists in both files
- Ensure capitalization matches

**"No bookingId found" warning in logs:**
- This warning is non-fatal
- A new bookingId is generated on confirm
- Email will still send with the new ID

**Waitlist not showing:**
- Verify slot capacity is reached
- Ensure bookedUsers count equals capacity
- Check waitlist key format is exactly `DATE|TIME|TITLE`

**Block booking spanning wrong dates:**
- All 4 dates must use same blockId
- Verify all 4 dates exist in availableSlots
- Check booking entries exist for all 4 dates in bookings.json

---

## Questions?

Refer to the main README.md or check the admin panel's data validation messages for guidance.
